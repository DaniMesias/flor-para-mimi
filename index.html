<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Peon칤as Cu치nticas</title>
    <style>
        * { margin: 0; padding: 0; }
        canvas { display: block; }
        body { overflow: hidden; background: #000; }
        #info { position: absolute; top: 10px; left: 10px; color: #fff; }
    </style>
</head>
<body>
    <div id="info">游꺚 Haz clic para mensajes especiales</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon-es@0.19.0/dist/cannon-es.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

<script>
// 1. Configuraci칩n inicial
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 2. Sistema de part칤culas estelares
const particles = new THREE.BufferGeometry();
const particlePositions = [];
for(let i = 0; i < 5000; i++) {
    particlePositions.push(
        Math.random() * 1600 - 800,
        Math.random() * 1600 - 800,
        Math.random() * 1600 - 800
    );
}
particles.setAttribute('position', new THREE.Float32BufferAttribute(particlePositions, 3));
const particleMaterial = new THREE.PointsMaterial({ size: 0.7, color: 0xFFFFFF });
const particleSystem = new THREE.Points(particles, particleMaterial);
scene.add(particleSystem);

// 3. Generador de peon칤as (Sistema complejo)
class Peonia {
    constructor() {
        this.group = new THREE.Group();
        this.createStem();
        this.createPetals();
        this.createStamens();
        this.createRoots();
        this.addPhysics();
    }

    createStem() {
        const stemGeometry = new THREE.CylinderGeometry(0.3, 0.5, 15, 32);
        const stemMaterial = new THREE.MeshPhongMaterial({ 
            color: 0x3d7a3d,
            bumpScale: 0.05,
            specular: 0x222222,
            shininess: 100
        });
        this.stem = new THREE.Mesh(stemGeometry, stemMaterial);
        this.stem.rotation.x = Math.PI / 2;
        this.group.add(this.stem);
    }

    createPetals() {
        const petalGeometry = new THREE.SphereGeometry(2, 32, 32, 0, Math.PI/1.5);
        const petalMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xff99ff,
            transmission: 0.4,
            roughness: 0.3,
            thickness: 0.2,
            specularIntensity: 0.7,
            side: THREE.DoubleSide
        });

        this.petals = [];
        for(let i = 0; i < 40; i++) {
            const petal = new THREE.Mesh(petalGeometry, petalMaterial);
            petal.position.y = 5 + i * 0.3;
            petal.rotation.z = Math.random() * Math.PI * 2;
            petal.scale.set(1.3 - i*0.02, 1.3 - i*0.02, 0.1);
            this.petals.push(petal);
            this.group.add(petal);
        }
    }

    createStamens() {
        const stamenGeometry = new THREE.SphereGeometry(0.1, 16, 16);
        const stamenMaterial = new THREE.MeshBasicMaterial({ 
            color: 0xffdd55,
            gradientMap: new THREE.TextureLoader().load('https://i.imgur.com/5V7ZJYF.png')
        });

        for(let i = 0; i < 80; i++) {
            const stamen = new THREE.Mesh(stamenGeometry, stamenMaterial);
            stamen.position.set(
                (Math.random() - 0.5) * 1.5,
                8.5 + Math.random() * 0.5,
                (Math.random() - 0.5) * 1.5
            );
            this.group.add(stamen);
        }
    }

    createRoots() {
        const rootGeometry = new THREE.TubeGeometry(
            new THREE.CatmullRomCurve3([
                new THREE.Vector3(0, 0, 0),
                new THREE.Vector3(Math.random()*2-1, -3, Math.random()*2-1),
                new THREE.Vector3(Math.random()*4-2, -6, Math.random()*4-2)
            ]), 64, 0.2, 8, false
        );
        
        const rootMaterial = new THREE.MeshLambertMaterial({ 
            color: 0x4a3728,
            wireframe: false 
        });

        for(let i = 0; i < 8; i++) {
            const root = new THREE.Mesh(rootGeometry, rootMaterial);
            root.rotation.y = (Math.PI / 4) * i;
            this.group.add(root);
        }
    }

    addPhysics() {
        // Configuraci칩n f칤sica con Cannon.js
        this.stemBody = new CANNON.Body({ mass: 0 });
        this.stemBody.addShape(new CANNON.Cylinder(0.3, 0.5, 15));
        world.addBody(this.stemBody);
    }
}

// 4. Sistema de suelo org치nico
const groundGeometry = new THREE.PlaneGeometry(200, 200, 50, 50);
const groundMaterial = new THREE.MeshStandardMaterial({
    color: 0x1a3a1a,
    displacementScale: 3,
    roughness: 0.8,
    metalness: 0.2
});
const ground = new THREE.Mesh(groundGeometry, groundMaterial);
ground.rotation.x = -Math.PI / 2;
ground.position.y = -7;
scene.add(ground);

// 5. Iluminaci칩n profesional
const light = new THREE.PointLight(0xffddcc, 1.5, 100);
light.position.set(10, 15, 10);
scene.add(light);

const ambient = new THREE.AmbientLight(0x404040);
scene.add(ambient);

const hemisphereLight = new THREE.HemisphereLight(0x443333, 0x111122, 0.6);
scene.add(hemisphereLight);

// 6. Configuraci칩n f칤sica
const world = new CANNON.World();
world.gravity.set(0, -9.82, 0);

// 7. Generar ramo de peon칤as
const peonias = [];
for(let i = 0; i < 5; i++) {
    const p = new Peonia();
    p.group.position.x = (i - 2) * 5;
    p.group.position.z = Math.random() * 3 - 1.5;
    scene.add(p.group);
    peonias.push(p);
}

// 8. Animaci칩n y renderizado
camera.position.set(0, 5, 20);
const controls = new THREE.OrbitControls(camera, renderer.domElement);

function animate() {
    requestAnimationFrame(animate);
    
    // Actualizar f칤sica
    world.step(1/60);
    
    // Sincronizar modelos 3D con cuerpos f칤sicos
    peonias.forEach(p => {
        p.stem.position.copy(p.stemBody.position);
        p.stem.quaternion.copy(p.stemBody.quaternion);
    });

    renderer.render(scene, camera);
}
animate();

// 9. Interactividad y mensajes
const messages = [
    "Te amo Mimi <3", 
    "Eres mi universo", 
    "Brillas m치s que las estrellas",
    "Eres eternamente hermosa"
];

document.addEventListener('click', () => {
    const messageElem = document.createElement('div');
    messageElem.style.cssText = `
        position: fixed;
        top: ${Math.random() * 80 + 10}%;
        left: ${Math.random() * 80 + 10}%;
        color: #ff99ff;
        font-size: 2em;
        text-shadow: 0 0 10px #ff00ff;
        pointer-events: none;
        transition: 2s;
    `;
    messageElem.textContent = messages[Math.floor(Math.random() * messages.length)];
    document.body.appendChild(messageElem);
    
    setTimeout(() => document.body.removeChild(messageElem), 2000);
});

// 10. Optimizaci칩n de ventana
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
